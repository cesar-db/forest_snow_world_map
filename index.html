<!DOCTYPE html>
<html>
<head>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
        integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
        crossorigin=""/>

    <style>
        #map {
            height: 600px;
        }
    </style>
</head>
<body>
    <div id="map"></div>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
        integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
        crossorigin=""></script>
    <script src="https://unpkg.com/georaster"></script>
    <script src="https://unpkg.com/georaster-layer-for-leaflet/dist/georaster-layer-for-leaflet.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/chroma-js/2.1.0/chroma.min.js"></script>
    <script>
        var map = L.map('map', {crs:L.CRS.EPSG3857}).setView([0., 0.], 2);

        L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
        }).addTo(map);


	var url_to_geotiff_file = "./data/FSF_11km.tif";

	fetch(url_to_geotiff_file)
	  .then(response => response.arrayBuffer())
	  .then(arrayBuffer => {
	    parseGeoraster(arrayBuffer).then(georaster => {
	      console.log("georaster:", georaster);
              var viridis = chroma.scale('viridis').domain([0, 100]);
	      // Fonction pour convertir les valeurs de pixels en couleurs
      	      function pixelValuesToColorFn(values) {
      	              var value = values[0];
      	              if (value < 1) {
                          return 'rgba(0, 0, 0, 0)'; // Transparent
                      }
                      if (value < 0) value = 0;
                      if (value > 100) value = 100;
                      return viridis(value).hex();
                    }
	      var layer = new GeoRasterLayer({
		  georaster: georaster,
		  opacity: 0.7,
                  pixelValuesToColorFn: pixelValuesToColorFn,
		  resolution: 64 // optional parameter for adjusting display resolution
	      });
	      layer.addTo(map);

	      map.fitBounds(layer.getBounds());
	                          // Ajouter un contrôle d'opacité
	      var opacityControl = L.control({ position: 'topright' });
	      opacityControl.onAdd = function (map) {
	      var div = L.DomUtil.create('div', 'opacity-control');
	      div.innerHTML = '<label>Opacity: <input type="range" min="0" max="1" step="0.1" value="0.7"></label>';
	      var input = div.querySelector('input');
	      input.addEventListener('input', function () {
	      	layer.setOpacity(parseFloat(input.value));
	      });
		return div;
		};
		opacityControl.addTo(map);         

	  });
	});
    </script>
    <style>
	.opacity-control {
	    background: white;
	    padding: 10px;
	    border-radius: 5px;
	    box-shadow: 0 0 10px rgba(0, 0, 0, 0.5);
	}
    </style>
</body>
</html>

